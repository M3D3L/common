import{u as h}from"./DO1rN-p-.js";import{a2 as d,U as m,ai as i,k as f}from"./DWH1ACXH.js";function S(){const t=h();d(),m();const o=i("auth:user",()=>t.authStore.model?u():null),a=i("auth:isAuthenticated",()=>t.authStore.isValid);f(()=>{t.authStore.loadFromCookie((document==null?void 0:document.cookie)||"")});function u(){const e=t.authStore.model;return e?{id:e.id,email:e.email,username:e.username,...e}:null}t.authStore.onChange((e,r)=>{o.value=u(),a.value=t.authStore.isValid,document.cookie=t.authStore.exportToCookie({httpOnly:!1,sameSite:"lax",secure:!0,path:"/"})},!0);async function s(e){try{return await t.collection("users").create(e),await n({email:e.email,password:e.password})}catch(r){return console.error("Registration error:",r),!1}}async function n(e){try{if(await t.collection("users").authWithPassword(e.email,e.password),!t.authStore.isValid)throw new Error("Authentication failed");return!0}catch(r){return console.error("Login error:",r),!1}}async function c(e){try{const r=await t.collection("users").authWithOAuth2({provider:e});if(!t.authStore.isValid)throw new Error("OAuth authentication failed");return!0}catch(r){return console.error("OAuth login error:",r),!1}}async function l(){try{return t.authStore.clear(),document.cookie=t.authStore.exportToCookie({expires:new Date(0),path:"/"}),!0}catch(e){return console.error("Logout error:",e),!1}}return{user:o,isAuthenticated:a,register:s,login:n,loginWithOAuth:c,logout:l}}export{S as u};
