import{A as F,i as O,B as U,b as P,u as B}from"./DO1rN-p-.js";import{r as N,f as D,G as j,v as _,e as L,l as R,x as K,$ as k,a9 as q}from"./DWH1ACXH.js";function z(i,c){const h=N(i);function l(y){return c[h.value][y]??h.value}return{state:h,dispatch:y=>{h.value=l(y)}}}function V(i,c){var m;const h=N({}),l=N("none"),A=N(i),y=i.value?"mounted":"unmounted";let g;const d=((m=c.value)==null?void 0:m.ownerDocument.defaultView)??F,{state:t,dispatch:s}=z(y,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}}),a=n=>{var o;if(O){const v=new CustomEvent(n,{bubbles:!1,cancelable:!1});(o=c.value)==null||o.dispatchEvent(v)}};D(i,async(n,o)=>{var b;const v=o!==n;if(await j(),v){const E=l.value,C=S(c.value);n?(s("MOUNT"),a("enter"),C==="none"&&a("after-enter")):C==="none"||C==="undefined"||((b=h.value)==null?void 0:b.display)==="none"?(s("UNMOUNT"),a("leave"),a("after-leave")):o&&E!==C?(s("ANIMATION_OUT"),a("leave")):(s("UNMOUNT"),a("after-leave"))}},{immediate:!0});const r=n=>{const o=S(c.value),v=o.includes(n.animationName),b=t.value==="mounted"?"enter":"leave";if(n.target===c.value&&v&&(a(`after-${b}`),s("ANIMATION_END"),!A.value)){const E=c.value.style.animationFillMode;c.value.style.animationFillMode="forwards",g=d==null?void 0:d.setTimeout(()=>{var C;((C=c.value)==null?void 0:C.style.animationFillMode)==="forwards"&&(c.value.style.animationFillMode=E)})}n.target===c.value&&o==="none"&&s("ANIMATION_END")},f=n=>{n.target===c.value&&(l.value=S(c.value))},e=D(c,(n,o)=>{n?(h.value=getComputedStyle(n),n.addEventListener("animationstart",f),n.addEventListener("animationcancel",r),n.addEventListener("animationend",r)):(s("ANIMATION_END"),g!==void 0&&(d==null||d.clearTimeout(g)),o==null||o.removeEventListener("animationstart",f),o==null||o.removeEventListener("animationcancel",r),o==null||o.removeEventListener("animationend",r))},{immediate:!0}),u=D(t,()=>{const n=S(c.value);l.value=t.value==="mounted"?n:"none"});return _(()=>{e(),u()}),{isPresent:L(()=>["mounted","unmountSuspended"].includes(t.value))}}function S(i){return i&&getComputedStyle(i).animationName||"none"}var Z=R({name:"Presence",props:{present:{type:Boolean,required:!0},forceMount:{type:Boolean}},slots:{},setup(i,{slots:c,expose:h}){var s;const{present:l,forceMount:A}=K(i),y=N(),{isPresent:g}=V(l,y);h({present:g});let d=c.default({present:g.value});d=U(d||[]);const t=q();if(d&&(d==null?void 0:d.length)>1){const a=(s=t==null?void 0:t.parent)!=null&&s.type.name?`<${t.parent.type.name} />`:"component";throw new Error([`Detected an invalid children for \`${a}\` for  \`Presence\` component.`,"","Note: Presence works similarly to `v-if` directly, but it waits for animation/transition to finished before unmounting. So it expect only one direct child of valid VNode type.","You can apply a few solutions:",["Provide a single child element so that `presence` directive attach correctly.","Ensure the first child is an actual element instead of a raw text node or comment node."].map(r=>`  - ${r}`).join(`
`)].join(`
`))}return()=>A.value||l.value||g.value?k(c.default({present:g.value})[0],{ref:a=>{const r=P(a);return typeof(r==null?void 0:r.hasAttribute)>"u"||(r!=null&&r.hasAttribute("data-reka-popper-content-wrapper")?y.value=r.firstElementChild:y.value=r),r}}):null}});const G=3600*1e3,J="app-cache",M="cache-db",w="cache-store",Y=({ttl:i=G,namespace:c=J,debug:h=!1}={})=>{const l=new Map;let A=!1;const y=`${c}|`;return(async()=>{if(!(typeof window>"u"||A))try{const e=indexedDB.open(M,1);e.onupgradeneeded=o=>{const v=e.result;v.objectStoreNames.contains(w)||v.createObjectStore(w,{keyPath:"key"})};const n=(await new Promise((o,v)=>{e.onsuccess=()=>o(e.result),e.onerror=()=>v(e.error)})).transaction(w,"readonly").objectStore(w).getAll();await new Promise(o=>{n.onsuccess=()=>{const v=n.result,b=Date.now();v.forEach(E=>{E.expiry>b&&l.set(E.key,{value:E.value,expiry:E.expiry})}),o()},n.onerror=()=>o()}),A=!0}catch(e){h&&console.error("IndexedDB initialization failed",e)}})().catch(()=>{}),{getCacheKey:(e,u={})=>{const p=Object.entries(u).sort(([m],[n])=>m.localeCompare(n)).map(([m,n])=>`${m}:${JSON.stringify(n)}`).join("|");return`${y}${e}|${p}`},set:(e,u,p)=>{const m=Date.now()+(p??i),n={value:u,expiry:m};l.set(e,n),typeof window<"u"&&(indexedDB.open(M).onsuccess=o=>{const E=o.target.result.transaction(w,"readwrite").objectStore(w);E.put({key:e,...n}).onerror=()=>{h&&console.error("Failed to persist cache entry")}})},get:e=>{const u=l.get(e);return u?u.expiry<Date.now()?(l.delete(e),typeof window<"u"&&(indexedDB.open(M).onsuccess=p=>{p.target.result.transaction(w,"readwrite").objectStore(w).delete(e)}),null):u.value:null},del:e=>{l.delete(e),typeof window<"u"&&(indexedDB.open(M).onsuccess=u=>{u.target.result.transaction(w,"readwrite").objectStore(w).delete(e)})},clearExpired:()=>{const e=Date.now();l.forEach((u,p)=>{u.expiry<=e&&l.delete(p)})},clearAll:()=>{l.clear(),typeof window<"u"&&(indexedDB.open(M).onsuccess=e=>{e.target.result.transaction(w,"readwrite").objectStore(w).clear()})}}},x=Y({ttl:60*60*1e3,namespace:"pb",debug:!1}),I=x.getCacheKey,T=x.set,$=x.get;function W(){const i=B();return{fetchCollection:async(t,s=1,a=10,r="",f="-created",e=null,u=null)=>{const p=I("fetchCollection",{collection:t,page:s,perPage:a,filter:r,sort:f,expand:e,fields:u}),m=$(p);if(m)return m;try{const n=await i.collection(t).getList(s,a,{filter:r,sort:f,expand:e??void 0,fields:u==null?void 0:u.join(",")});return T(p,n),n}catch(n){throw console.error(`Error fetching ${t}:`,n),new Error(`Failed to fetch ${t}`)}},fetchRecord:async(t,s)=>{const a=s.toString(),r=I("fetchRecord",{collection:t,id:a}),f=$(r);if(f)return f;try{const e=await i.collection(t).getOne(a);return T(r,e),e}catch(e){throw console.error(`Error fetching ${t} record ${a}:`,e),new Error(`Failed to fetch ${t} record`)}},createItem:async(t,s)=>{try{return await i.collection(t).create(s)}catch(a){throw console.error(`Error creating item in ${t}:`,a),new Error(`Failed to create item in ${t}`)}},updateItem:async(t,s,a)=>{try{return await i.collection(t).update(s,a)}catch(r){throw console.error(`Error updating item in ${t}:`,r),new Error(`Failed to update item in ${t}`)}},deleteItem:async(t,s)=>{try{return await i.collection(t).delete(s),!0}catch(a){throw console.error(`Error deleting item from ${t}:`,a),new Error(`Failed to delete item from ${t}`)}},uploadFile:async(t,s,a,r)=>{try{const f=new FormData;f.append(r,t);const e=await i.collection(s).update(a,f);return i.files.getUrl(e,e[r])}catch(f){throw console.error("Error uploading file:",f),new Error("Failed to upload file")}},getFileUrl:(t,s)=>i.files.getUrl(t,s),getCacheKey:I}}export{Z as P,Y as a,W as u};
